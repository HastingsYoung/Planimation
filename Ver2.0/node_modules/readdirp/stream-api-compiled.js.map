{"version":3,"sources":["stream-api.js"],"names":[],"mappings":"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","file":"stream-api-compiled.js","sourcesContent":["'use strict';\n\nvar si =  require('set-immediate-shim');\nvar stream = require('readable-stream');\nvar util = require('util');\n\nvar Readable = stream.Readable;\n\nmodule.exports = ReaddirpReadable;\n\nutil.inherits(ReaddirpReadable, Readable);\n\nfunction ReaddirpReadable (opts) {\n  if (!(this instanceof ReaddirpReadable)) return new ReaddirpReadable(opts);\n\n  opts = opts || {};\n\n  opts.objectMode = true;\n  Readable.call(this, opts);\n\n  // backpressure not implemented at this point\n  this.highWaterMark = Infinity;\n\n  this._destroyed = false;\n  this._paused = false;\n  this._warnings = [];\n  this._errors = [];\n\n  this._pauseResumeErrors();\n}\n\nvar proto = ReaddirpReadable.prototype;\n\nproto._pauseResumeErrors = function () {\n  var self = this;\n  self.on('pause', function () { self._paused = true });\n  self.on('resume', function () {\n    if (self._destroyed) return;\n    self._paused = false;\n\n    self._warnings.forEach(function (err) { self.emit('warn', err) });\n    self._warnings.length = 0;\n\n    self._errors.forEach(function (err) { self.emit('error', err) });\n    self._errors.length = 0;\n  })\n}\n\n// called for each entry\nproto._processEntry = function (entry) {\n  if (this._destroyed) return;\n  this.push(entry);\n}\n\nproto._read = function () { }\n\nproto.destroy = function () {\n  // when stream is destroyed it will emit nothing further, not even errors or warnings\n  this.push(null);\n  this.readable = false;\n  this._destroyed = true;\n  this.emit('close');\n}\n\nproto._done = function () {\n  this.push(null);\n}\n\n// we emit errors and warnings async since we may handle errors like invalid args\n// within the initial event loop before any event listeners subscribed\nproto._handleError = function (err) {\n  var self = this;\n  si(function () {\n    if (self._paused) return self._warnings.push(err);\n    if (!self._destroyed) self.emit('warn', err);\n  });\n}\n\nproto._handleFatalError = function (err) {\n  var self = this;\n  si(function () {\n    if (self._paused) return self._errors.push(err);\n    if (!self._destroyed) self.emit('error', err);\n  });\n}\n\nfunction createStreamAPI () {\n  var stream = new ReaddirpReadable();\n\n  return {\n      stream           :  stream\n    , processEntry     :  stream._processEntry.bind(stream)\n    , done             :  stream._done.bind(stream)\n    , handleError      :  stream._handleError.bind(stream)\n    , handleFatalError :  stream._handleFatalError.bind(stream)\n  };\n}\n\nmodule.exports = createStreamAPI;\n"]}